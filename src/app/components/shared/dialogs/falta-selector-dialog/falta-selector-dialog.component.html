<div class="dialog-overlay" [ngClass]="turnDialogVisible()">
  <div
    class="dialog-box"
    role="dialog"
    aria-modal="true"
    aria-labelledby="dialog-title"
  >
    <button
      class="dialog-close-btn"
      (click)="closeDialog()"
      aria-label="Fechar"
    >
      &times;
    </button>

    <div class="dialog-icon">
      <mat-icon>add_circle</mat-icon>
    </div>

    <div class="dialog-header">
      <h2 class="dialog-title" id="dialog-title">Adicionar Faltas</h2>
      <p class="dialog-message">{{ materia }}</p>
    </div>

    <div class="faltas-info">
      <p class="faltas-status">
        Faltas atuais: <strong>{{ faltasAtuais }}</strong> /
        {{ faltasMaximas }}
      </p>
      @if (faltasDisponiveis > 0) {
      <p class="faltas-disponiveis">
        Você pode faltar mais <strong>{{ faltasDisponiveis }}</strong> vez(es)
      </p>
      } @if (faltasDisponiveis === 0) {
      <p class="faltas-limite">Limite de faltas atingido</p>
      }
    </div>

    <!-- Seção Premium: Seletor de dia -->
    @if (isPremium && faltasDisponiveis > 0 && diasComAula.length > 0) {
    <div class="dia-selector">
      <label for="dia-select">Selecione o dia da falta</label>
      <select
        id="dia-select"
        name="dia-select"
        [(ngModel)]="diaSelecionado"
        (change)="onDiaChange()"
        class="dia-select"
      >
        <option value="">Seleção manual</option>
        @for (dia of diasComAula; track dia.value) {
        <option [value]="dia.value">{{ dia.nome }} ({{ dia.horas }}h)</option>
        }
      </select>
      @if (!diaSelecionado) {
      <p class="premium-info">
        Você pode selecionar o dia da aula para auto-preenchimento
      </p>
      }
    </div>
    } @if (faltasDisponiveis > 0) {
    <div class="quantidade-selector">
      <label for="quantidade-faltas">Quantidade de faltas a adicionar:</label>

      <div class="quantidade-control">
        <button
          type="button"
          class="btn-counter"
          (click)="decrementarQuantidade()"
          [disabled]="quantidadeFaltas <= 1"
          aria-label="Diminuir quantidade"
        >
          -
        </button>

        <input
          type="number"
          id="quantidade-faltas"
          [(ngModel)]="quantidadeFaltas"
          [min]="1"
          [max]="faltasDisponiveis"
          class="quantidade-input"
          (input)="onQuantidadeChange($event)"
          (blur)="validateQuantidade()"
          (focus)="onFocus($event)"
          (keypress)="onKeyPress($event)"
        />

        <button
          type="button"
          class="btn-counter"
          (click)="incrementarQuantidade()"
          [disabled]="quantidadeFaltas >= faltasDisponiveis"
          aria-label="Aumentar quantidade"
        >
          +
        </button>
      </div>
    </div>
    }

    <div class="dialog-footer">
      <button class="dialog-btn dialog-btn--cancel" (click)="closeDialog()">
        Cancelar
      </button>
      <button
        class="dialog-btn dialog-btn--confirm"
        (click)="confirmarAdicao()"
        [disabled]="faltasDisponiveis === 0"
      >
        Adicionar {{ quantidadeFaltas }} falta{{
          quantidadeFaltas !== 1 ? "s" : ""
        }}
      </button>
    </div>
  </div>
</div>
